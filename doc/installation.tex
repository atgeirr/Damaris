%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%==============================================================================%
%==============================================================================%
\section{Dependencies}\label{sec:dependencies}

In the following, we will assume that you install all dependencies locally in \installdir.
\Damaris{} requires the following dependencies.
\begin{itemize}
	\item CMake (2.8 or newer), \\ available at \url{http://www.cmake.org/}
	\item The XSD code synthesis library, \\ available at \url{http://www.codesynthesis.com/products/xsd/}
	\item The Xerces-C library (version 3.1.1 or newer), \\
	available at \url{http://xerces.apache.org/xerces-c/download.cgi}
	\item The following parts of the Boost C++ library (version 1.51 or newer): 
	date\_time, filesystem and system, available at \url{http://www.boost.org/}
	\item An MPI C++ compiler.
\end{itemize}

The support for VisIt can be enabled by installing the corresponding
libraries (see Chapters~\ref{chap:VisIt}).

\vspace{0.5cm}

\noindent\textbf{Note:} The Python plugin system, enabled in earlier versions of \Damaris{}
and presented in some of the papers related to \Damaris,
has been disabled starting from version 1.0, the reason being the lack of engineering 
support in our team and the lack of users effectively leveraging Python. If you are
interested in using Python plugins with \Damaris, we invite you to contact the developers
and the necessary work will be carried out for the next version.

\subsection{Xerces-C}

Download Xerces-C (version 3.1.1 or greater). Take the source for your platform.
Configure and compile it:

\begin{verbatim}
./configure --prefix=$HOME/local --disable-threads --disable-network
make
make install
\end{verbatim}

\subsection{Boost}

Download Boost (version 1.51 or higher). Configure and compile it:

\begin{verbatim}
./bootstrap.sh --prefix=$HOME/local --with-libraries=date_time,system,filesystem 
./b2
./b2 install
\end{verbatim}

\subsection{XSD codesynthesis}

Download the XSD sources for your platform.
Untar/unzip it and install it by copying it into the \installdir directory.
Starting from Damaris 1.0.1, the \texttt{xsd} executable is not required, only the header
files are. Make sure that the XSD headers are copies in the \installdir/include directory.

If you use the trunk version of Damaris, from the GIT repository, you will need the \texttt{xsd}
executable to be installed as well in \installdir/bin. Make sure also that this directory is in the PATH environment variable
so that \texttt{xsd} can be called.

%==============================================================================%
%==============================================================================%

\section{Compiling \Damaris{}}

Download and untar the \Damaris{} archive. \Damaris{} uses CMake to be compiled.
Make sure the \texttt{cmake} command is in your PATH environment variable.

In the \Damaris{} root directory, the \file{CMakeLists.txt} file contains the 
compilation directives and various options. 
If needed, you can open this file and modify the lines listed in 
Table~\ref{tab:cmake} to adapt the location of dependencies.
When these modifications are done, make sure your working directory is \Damaris' root 
directory and type
\begin{verbatim}
cmake -G "Unix Makefiles" -DCMAKE_INSTALL_PREFIX:PATH=$HOME/local
\end{verbatim}
This will generate the \file{Makefile} to compile \Damaris. Go on with 
\begin{verbatim}
make
make install
\end{verbatim}
You're done! Check your \installdir, you should see \texttt{Damaris.h} in the 
include directory, as well as a \texttt{damaris} directory,
and \texttt{libdamaris.a} in the lib directory. If \Damaris{} has been compiled 
with Fortran support, a \texttt{damaris.mod} file is also present in 
the target install directory.

\begin{table}
\centering
\begin{tabular}{|l|l|l|}
	\hline
   Line & Variable & Content \\
   \hline
   \hline
   13 &  & Name of the C++ MPI compiler. \\
   14 &  & Name of the C MPI compiler. \\
   15 &  & Name of the Fortran MPI compiler (uncomment if needed). \\
   27 & EXTERNAL\_ROOT & Prefix path where dependencies have been installed. \\
   28 & XERCESC\_ROOT & Xerces-C library location. \\
   29 & XSD\_ROOT & XSD library location. \\
   30 & BOOST\_ROOT & Boost library location. \\
   31 & VISIT\_ROOT & Location of VisIt. Comment if you don't need VisIt support. \\
   61 & BGP & Uncomment if you run on BlueGene/P. \\
   \hline
\end{tabular}\caption{CMakeLists.txt modifications before compiling \Damaris{}}\label{tab:cmake}
\end{table}

\vspace{0.5cm}

\noindent\textbf{Note:} \Damaris{} uses MPI\_Get\_processor\_name and expect it to return the same
name on all the cores of the same SMP node. It may not be the case on some platforms. 
On BlueGene/P, don't forget to use the BGP flag to use BGP's personality functions instead.